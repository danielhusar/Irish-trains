/* irish-trains 04.29.2013 */
(function(){var t=window.helpers={},n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};t.transEndEventName=n[Modernizr.prefixed("transition")];for(var i,a=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],e=o.length,s=window.console=window.console||{};e--;)i=o[e],s[i]||(s[i]=a)})(),function(t,n,i){"use strict";var a=t.Trains=function(t){this.limit=t,this.loadStations(),this.plugEvents()};a.prototype.plugEvents=function(){var n=this;i('[data-plugin="reload"]').on("click",function(a){var o=i(this);n.loadStations(),o.addClass("rotate").on(t.helpers.transEndEventName,function(){o.removeClass("rotate")}),a.preventDefault()}),i('[data-plugin="back"]').on("click",function(t){i("#wrap").removeClass("page-trains"),i("#trains ul").html(""),t.preventDefault()}),i("#stations").on("click","[data-station]",function(t){var a=i(this).data("station");i("#wrap").addClass("page-trains"),i("nav h2 span").text(a),n.loadTrains(a.replace(/ /g,"_")),t.preventDefault()})},a.prototype.loadStations=function(){var t,n=this.limit,a=i("#stations"),o=a.find("ul");a.addClass("loading"),o.hide().html(""),this.getPosition(function(e){i.getJSON("/json/stations/"+e.coords.latitude+"/"+e.coords.longitude,function(e){for(;n--;){var s=e[n];t=i("<li />").attr("data-station",s.StationDesc).html(s.StationDesc+'<a href="#" class="btn btn-info btn-small"><i class="icon-white icon-circle-arrow-right"></i></a> 																	<span>('+Math.round(s.dist)+" km near)</span> 																"),o.prepend(t)}a.removeClass("loading"),o.fadeIn()})})},a.prototype.loadTrains=function(t){var n,a=i("#trains"),o=a.find("ul");a.addClass("loading"),o.hide().html(""),i.getJSON("/json/trains/"+t,function(t){t.length?i.each(t,function(t,a){n=i("<li />").html("<h5>"+a.Origin+" ("+a.Origintime+" ) - "+a.Destination+" ("+a.Destinationtime+")</h5> 																	<span>Departure: "+("00:00"!==a.Schdepart?a.Schdepart:a.Expdepart)+"</span> 																"),o.append(n)}):(n=i("<li />").addClass("error").html("Sorry, but theres no departures in next 90 minutes."),o.prepend(n)),a.removeClass("loading"),o.fadeIn()})},a.prototype.getPosition=function(t){navigator.geolocation.getCurrentPosition(t)}}(this,this.document,this.jQuery),function(){"use strict";new Trains(5)}(this,this.document,this.jQuery);