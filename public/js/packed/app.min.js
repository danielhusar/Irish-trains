/* irish-trains 07.13.2014 */
!function(){var a=window.helpers={},b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};a.transEndEventName=b[Modernizr.prefixed("transition")];for(var c,d=function(){},e=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],f=e.length,g=window.console=window.console||{};f--;)c=e[f],g[c]||(g[c]=d)}(),function(a,b,c){"use strict";var d=a.Trains=function(a){this.limit=a,this.loadStations(),this.plugEvents()};d.prototype.plugEvents=function(){var b=this;c('[data-plugin="reload"]').on("click",function(d){var e=c(this);b.loadStations(),e.addClass("rotate").on(a.helpers.transEndEventName,function(){e.removeClass("rotate")}),d.preventDefault()}),c('[data-plugin="back"]').on("click",function(a){c("#wrap").removeClass("page-trains"),c("#trains ul").html(""),a.preventDefault()}),c("#stations").on("click","[data-station]",function(a){var d=c(this).data("station");c("#wrap").addClass("page-trains"),c("nav h2 span").text(d),b.loadTrains(d.replace(/ /g,"_")),a.preventDefault()})},d.prototype.loadStations=function(){var a,b=this.limit,d=c("#stations"),e=d.find("ul");d.addClass("loading"),e.hide().html(""),this.getPosition(function(f){c.getJSON("/json/stations/"+f.coords.latitude+"/"+f.coords.longitude,function(f){for(;b--;){var g=f[b];a=c("<li />").attr("data-station",g.StationDesc).html(g.StationDesc+'<a href="#" class="btn btn-info btn-small"><i class="icon-white icon-circle-arrow-right"></i></a> 																	<span>('+Math.round(g.dist)+" km near)</span> 																"),e.prepend(a)}d.removeClass("loading"),e.fadeIn()})})},d.prototype.loadTrains=function(a){var b,d=c("#trains"),e=d.find("ul");d.addClass("loading"),e.hide().html(""),c.getJSON("/json/trains/"+a,function(a){a.length?c.each(a,function(a,d){b=c("<li />").html("<h5>"+d.Origin+" ("+d.Origintime+" ) - "+d.Destination+" ("+d.Destinationtime+")</h5> 																	<span>Departure: "+("00:00"!==d.Schdepart?d.Schdepart:d.Expdepart)+"</span> 																"),e.append(b)}):(b=c("<li />").addClass("error").html("Sorry, but theres no departures in next 90 minutes."),e.prepend(b)),d.removeClass("loading"),e.fadeIn()})},d.prototype.getPosition=function(a){navigator.geolocation.getCurrentPosition(a)}}(this,this.document,this.jQuery),function(){"use strict";new Trains(5)}(this,this.document,this.jQuery);